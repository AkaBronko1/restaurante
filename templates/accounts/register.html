{% extends 'main/base.html' %}
{% load static %}

{% block title %}Registrarse - Pizza Moderna{% endblock %}

{% block nav_login %}active{% endblock %}

{% block hero %}
<!-- Hero section personalizada para registro -->
<section class="hero-section bg-dark text-white position-relative overflow-hidden py-5">
  <div class="hero-bg"></div>
  <div class="container position-relative">
    <div class="row justify-content-center">
      <div class="col-lg-6 text-center" data-aos="fade-down">
        <i class="bi bi-person-plus-fill display-1 text-warning mb-3"></i>
        <h1 class="display-4 fw-bold mb-3">Únete a nosotros</h1>
        <p class="lead text-light">Crea tu cuenta y disfruta de todos los beneficios</p>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block content %}
<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-5 col-md-7">
      
      <!-- Card de Registro -->
      <div class="card shadow-lg border-0" data-aos="fade-up">
        <div class="card-header bg-warning text-dark text-center py-4">
          <h3 class="mb-0 fw-bold">
            <i class="bi bi-pizza me-2"></i>
            Crear Cuenta
          </h3>
        </div>
        
        <div class="card-body p-5">
          <!-- Mensajes de error -->
          {% if form.errors %}
            <div class="alert alert-danger d-flex align-items-center" role="alert">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <div>
                <strong>Error:</strong> Por favor corrige los errores a continuación.
              </div>
            </div>
          {% endif %}

          {% if form.non_field_errors %}
            <div class="alert alert-danger d-flex align-items-center" role="alert">
              <i class="bi bi-exclamation-triangle me-2"></i>
              <div>
                {% for error in form.non_field_errors %}
                  {{ error }}
                {% endfor %}
              </div>
            </div>
          {% endif %}

          <!-- Formulario de Registro -->
          <form method="post" novalidate>
            {% csrf_token %}
            
            <!-- Campo Usuario -->
            <div class="mb-4">
              <label for="id_username" class="form-label fw-semibold">
                <i class="bi bi-person me-1"></i>Nombre de Usuario
              </label>
              <input 
                type="text" 
                class="form-control form-control-lg {% if form.username.errors %}is-invalid{% endif %}" 
                id="id_username" 
                name="username" 
                value="{{ form.username.value|default:'' }}"
                placeholder="Tu nombre de usuario"
                required
                autocomplete="username"
              >
              {% if form.username.errors %}
                <div class="invalid-feedback">
                  {% for error in form.username.errors %}
                    {{ error }}
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Campo Email -->
            <div class="mb-4">
              <label for="id_email" class="form-label fw-semibold">
                <i class="bi bi-envelope me-1"></i>Correo Electrónico
              </label>
              <input 
                type="email" 
                class="form-control form-control-lg {% if form.email.errors %}is-invalid{% endif %}" 
                id="id_email" 
                name="email" 
                value="{{ form.email.value|default:'' }}"
                placeholder="tu@email.com"
                required
                autocomplete="email"
              >
              {% if form.email.errors %}
                <div class="invalid-feedback">
                  {% for error in form.email.errors %}
                    {{ error }}
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Campo Contraseña -->
            <div class="mb-4">
              <label for="id_password1" class="form-label fw-semibold">
                <i class="bi bi-lock me-1"></i>Contraseña
              </label>
              <div class="input-group">
                <input 
                  type="password" 
                  class="form-control form-control-lg {% if form.password1.errors %}is-invalid{% endif %}" 
                  id="id_password1" 
                  name="password1"
                  placeholder="Mínimo 8 caracteres"
                  required
                  autocomplete="new-password"
                >
                <button class="btn btn-outline-secondary" type="button" id="togglePassword1">
                  <i class="bi bi-eye" id="toggleIcon1"></i>
                </button>
                {% if form.password1.errors %}
                  <div class="invalid-feedback">
                    {% for error in form.password1.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Campo Confirmar Contraseña -->
            <div class="mb-4">
              <label for="id_password2" class="form-label fw-semibold">
                <i class="bi bi-lock-fill me-1"></i>Confirmar Contraseña
              </label>
              <div class="input-group">
                <input 
                  type="password" 
                  class="form-control form-control-lg {% if form.password2.errors %}is-invalid{% endif %}" 
                  id="id_password2" 
                  name="password2"
                  placeholder="Repite tu contraseña"
                  required
                  autocomplete="new-password"
                >
                <button class="btn btn-outline-secondary" type="button" id="togglePassword2">
                  <i class="bi bi-eye" id="toggleIcon2"></i>
                </button>
                {% if form.password2.errors %}
                  <div class="invalid-feedback">
                    {% for error in form.password2.errors %}
                      {{ error }}
                    {% endfor %}
                  </div>
                {% endif %}
              </div>
            </div>

            <!-- Términos y condiciones -->
            <div class="mb-4">
              <div class="form-check">
                <input 
                  class="form-check-input" 
                  type="checkbox" 
                  id="terms" 
                  required
                >
                <label class="form-check-label small" for="terms">
                  Acepto los <a href="#" class="text-decoration-none">términos y condiciones</a> y la 
                  <a href="#" class="text-decoration-none">política de privacidad</a>
                </label>
              </div>
            </div>

            <!-- Botón de Registro -->
            <div class="d-grid mb-4">
              <button type="submit" class="btn btn-warning btn-lg text-dark fw-bold py-3">
                <i class="bi bi-person-plus me-2"></i>
                Crear Mi Cuenta
              </button>
            </div>

          </form>
        </div>
      </div>

      <!-- Enlace a Login -->
      <div class="text-center mt-4" data-aos="fade-up" data-aos-delay="200">
        <div class="card border-0 bg-light">
          <div class="card-body py-4">
            <p class="mb-3 text-muted">¿Ya tienes una cuenta?</p>
            <a href="{% url 'accounts:login' %}" class="btn btn-outline-warning btn-lg">
              <i class="bi bi-box-arrow-in-right me-2"></i>
              Iniciar Sesión
            </a>
          </div>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- Script para mostrar/ocultar contraseñas -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Toggle password 1
    const togglePassword1 = document.getElementById('togglePassword1');
    const passwordInput1 = document.getElementById('id_password1');
    const toggleIcon1 = document.getElementById('toggleIcon1');

    if (togglePassword1) {
        togglePassword1.addEventListener('click', function() {
            const type = passwordInput1.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput1.setAttribute('type', type);
            toggleIcon1.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
        });
    }

    // Toggle password 2
    const togglePassword2 = document.getElementById('togglePassword2');
    const passwordInput2 = document.getElementById('id_password2');
    const toggleIcon2 = document.getElementById('toggleIcon2');

    if (togglePassword2) {
        togglePassword2.addEventListener('click', function() {
            const type = passwordInput2.getAttribute('type') === 'password' ? 'text' : 'password';
            passwordInput2.setAttribute('type', type);
            toggleIcon2.className = type === 'password' ? 'bi bi-eye' : 'bi bi-eye-slash';
        });
    }
});
</script>

<!-- Estilos adicionales -->
<style>
.hero-section {
    position: relative;
    min-height: 300px;
}

.hero-bg {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    opacity: 0.1;
}

.card {
    border-radius: 15px;
    overflow: hidden;
}

.card-header {
    border-bottom: none;
}

.form-control:focus {
    border-color: #ffc107;
    box-shadow: 0 0 0 0.25rem rgba(255, 193, 7, 0.25);
}

.btn-warning:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 193, 7, 0.3);
}

.small {
    font-size: 0.875rem;
}
</style>
{% endblock %}
